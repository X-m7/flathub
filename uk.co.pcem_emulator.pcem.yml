app-id: uk.co.pcem_emulator.pcem
runtime: org.freedesktop.Platform
runtime-version: '20.08'
sdk: org.freedesktop.Sdk
command: pcem
finish-args:
  - --share=network
  - --socket=x11
  - --socket=pulseaudio
  - --persist=.pcem
  # CD access
  - --device=all

modules:
  # wxWidgets does support GTK3 but PCem itself doesn't (not properly that is)
  - shared-modules/gtk2/gtk2.json

  - name: wxWidgets
    cleanup:
      - /include
      - /bin
      - /share/aclocal
      - /share/bakefile
    config-opts:
      - --with-gtk=2
    sources:
      - type: archive
        url: https://github.com/wxWidgets/wxWidgets/releases/download/v3.1.4/wxWidgets-3.1.4.tar.bz2
        sha512: aabb257fa222eb819f1e16086977b0ecfd3eb3406d695e0e642ffdb8b4dc586a9721404916be4756a2d92a1a8dc41b661b54717a64e03850a8a92d32d45ece14

  # Autoreconf is needed since something is apparently hardcoded to need autotools 1.15
  - name: pcem
    buildsystem: simple
    build-commands:
      - autoreconf -f -i
      - ./configure --enable-release-build --enable-networking --enable-alsa
      - make -j$FLATPAK_BUILDER_N_JOBS
      - install -Dm755 pcem /app/bin/pcem
      - install -Dm644 uk.co.pcem_emulator.pcem.metainfo.xml /app/share/metainfo/uk.co.pcem_emulator.pcem.metainfo.xml
      - install -Dm644 uk.co.pcem_emulator.pcem.desktop /app/share/applications/uk.co.pcem_emulator.pcem.desktop
      - install -Dm644 uk.co.pcem_emulator.pcem.svg /app/share/icons/hicolor/scalable/apps/uk.co.pcem_emulator.pcem.svg
    sources:
      - type: archive
        url: https://pcem-emulator.co.uk/files/PCemV17Linux.tar.gz
        sha512: 6d84c8cbe9b6116f6439f542ac08139cfc5652a34b615a1ed841a6f8c227e77f1d26573ec35d57511b9a69e7472fbe51f2abb9307f8f8c1207c74fbe8107cadd
        strip-components: 0
      - type: file
        path: uk.co.pcem_emulator.pcem.metainfo.xml
      - type: file
        path: uk.co.pcem_emulator.pcem.desktop
      - type: file
        path: uk.co.pcem_emulator.pcem.svg
